---
id: import-pathologists
title: Import Pathologists
sidebar_position: 2
---

# Script de Importaci√≥n de Pat√≥logos

El script `import_pathologists.py` es responsable de crear usuarios pat√≥logos en el sistema PathSys. Este script importa m√©dicos especialistas en patolog√≠a y residentes, generando autom√°ticamente c√≥digos √∫nicos, iniciales y emails basados en sus nombres y c√≥digos identificadores.

## Objetivo

Poblar el sistema con m√©dicos pat√≥logos y residentes de patolog√≠a, estableciendo sus perfiles profesionales, credenciales de acceso y c√≥digos √∫nicos para identificaci√≥n en el sistema.

## Ubicaci√≥n del Archivo

```
Back-End/Scripts/import_pathologists.py
```

## Funcionalidad Principal

### Creaci√≥n de Pat√≥logos
El script crea usuarios pat√≥logos con la siguiente informaci√≥n:

- **Datos profesionales**: Nombre completo, especialidad, c√≥digo √∫nico
- **Credenciales**: Email generado autom√°ticamente, contrase√±a temporal
- **Identificaci√≥n**: Iniciales derivadas del nombre, c√≥digo de pat√≥logo
- **Estado**: Usuarios activos por defecto

### Generaci√≥n Autom√°tica de Datos

#### Iniciales
```python
def generate_initials(name: str) -> str:
    """Generate initials from pathologist name"""
    words = name.split()
    initials = ''.join([word[0].upper() for word in words if word])
    return initials[:3]  # Maximum 3 characters
```

#### Email
```python
def generate_email(code: str, name: str) -> str:
    """Generate email from code and name"""
    clean_name = name.lower().replace(' ', '.')
    return f"{code.lower()}.{clean_name}@pathsys.com"
```

### Pat√≥logos Predefinidos

El script incluye una lista de pat√≥logos con sus c√≥digos y nombres:

```python
pathologists_data = [
    {
        "code": "PAT001",
        "name": "Dr. Mar√≠a Elena Rodr√≠guez",
        "specialty": "Anatom√≠a Patol√≥gica"
    },
    {
        "code": "PAT002", 
        "name": "Dr. Carlos Alberto Mendoza",
        "specialty": "Patolog√≠a Oncol√≥gica"
    },
    {
        "code": "RES001",
        "name": "Dr. Ana Sof√≠a Herrera",
        "specialty": "Residente Patolog√≠a"
    },
    {
        "code": "RES002",
        "name": "Dr. Luis Fernando Castro",
        "specialty": "Residente Patolog√≠a"
    }
    # ... m√°s pat√≥logos
]
```

## Dependencias y Servicios

### Servicios Utilizados
- **`PathologistService`**: Servicio principal para gesti√≥n de pat√≥logos
- **`get_pathologist_service()`**: Factory para obtener instancia del servicio

### Esquemas de Datos
- **`PathologistCreate`**: Schema Pydantic para validaci√≥n de datos de pat√≥logos

### Importaciones Principales
```python
from app.modules.pathologists.services.pathologist_service import get_pathologist_service
from app.modules.pathologists.schemas.pathologist import PathologistCreate
```

## Estructura del Script

### 1. Configuraci√≥n Inicial
```python
import asyncio
from typing import List, Dict
import logging
import re

# Setup logging
logging.basicConfig(level=logging.INFO)
logger = logging.getLogger(__name__)
```

### 2. Funciones Auxiliares
```python
def normalize_text(text: str) -> str:
    """Normalize text for consistent formatting"""
    return re.sub(r'\s+', ' ', text.strip())

def generate_initials(name: str) -> str:
    """Generate initials from pathologist name"""
    words = name.split()
    return ''.join([word[0].upper() for word in words if word])[:3]

def generate_email(code: str, name: str) -> str:
    """Generate email from code and name"""
    clean_name = name.lower().replace(' ', '.').replace('dr.', '')
    return f"{code.lower()}.{clean_name}@pathsys.com"
```

### 3. Funci√≥n Principal
```python
async def import_pathologists():
    """Import predefined pathologists into the system"""
    service = get_pathologist_service()
    
    for pathologist_data in PATHOLOGISTS_DATA:
        try:
            # Generate derived fields
            initials = generate_initials(pathologist_data["name"])
            email = generate_email(pathologist_data["code"], pathologist_data["name"])
            
            # Create pathologist schema
            pathologist_create = PathologistCreate(
                code=pathologist_data["code"],
                name=normalize_text(pathologist_data["name"]),
                initials=initials,
                email=email,
                specialty=pathologist_data["specialty"],
                password="pathologist123"  # Temporary password
            )
            
            # Check if pathologist already exists
            existing = await service.get_pathologist_by_code(pathologist_data["code"])
            if existing:
                logger.info(f"Pathologist {pathologist_data['code']} already exists")
                continue
            
            # Create new pathologist
            result = await service.create_pathologist(pathologist_create)
            logger.info(f"Created pathologist: {result.code} - {result.name}")
            
        except Exception as e:
            logger.error(f"Error creating pathologist {pathologist_data['code']}: {e}")
```

## Caracter√≠sticas T√©cnicas

### üîß Generaci√≥n Autom√°tica
- **Iniciales**: Extracci√≥n autom√°tica de iniciales del nombre
- **Email**: Composici√≥n basada en c√≥digo y nombre normalizado
- **C√≥digos √∫nicos**: Validaci√≥n de unicidad de c√≥digos de pat√≥logo
- **Normalizaci√≥n**: Limpieza y formato consistente de texto

### üîí Validaciones
- **C√≥digo √∫nico**: Verificaci√≥n de c√≥digos no duplicados
- **Email √∫nico**: Control de emails no duplicados
- **Formato de datos**: Validaci√≥n mediante schemas Pydantic
- **Existencia previa**: Verificaci√≥n antes de crear

### üõ°Ô∏è Seguridad
- **Contrase√±as temporales**: Contrase√±as que deben cambiarse en primer acceso
- **Validaci√≥n de entrada**: Sanitizaci√≥n de datos de entrada
- **Manejo de errores**: Control robusto de excepciones
- **Logging seguro**: Registro sin exponer credenciales

### ‚ö° Rendimiento
- **Operaciones as√≠ncronas**: Procesamiento no bloqueante
- **Verificaci√≥n previa**: Evita duplicados innecesarios
- **Transacciones at√≥micas**: Consistencia de datos
- **Procesamiento en lote**: Importaci√≥n eficiente de m√∫ltiples pat√≥logos

## Uso del Script

### Ejecuci√≥n B√°sica
```bash
# Desde el directorio ra√≠z del proyecto
python3 Scripts/import_pathologists.py
```

### Ejecuci√≥n con Modo Dry-Run
```bash
# Previsualizaci√≥n sin cambios reales
python3 Scripts/import_pathologists.py --dry-run
```

### Verificaci√≥n de Resultados
```bash
# Verificar pat√≥logos creados
python3 -c "
from app.modules.pathologists.services.pathologist_service import get_pathologist_service
import asyncio

async def check_pathologists():
    service = get_pathologist_service()
    pathologists = await service.list_pathologists()
    print(f'Total pathologists: {len(pathologists)}')
    for path in pathologists:
        print(f'- {path.code}: {path.name} ({path.email})')

asyncio.run(check_pathologists())
"
```

## Casos de Uso

### 1. Inicializaci√≥n del Sistema
```python
# Cargar pat√≥logos iniciales
await import_pathologists()
print("Pat√≥logos importados exitosamente")
```

### 2. Adici√≥n de Nuevos Pat√≥logos
```python
# Agregar nuevo pat√≥logo a la lista
new_pathologist = {
    "code": "PAT010",
    "name": "Dr. Patricia Morales",
    "specialty": "Patolog√≠a Pedi√°trica"
}
PATHOLOGISTS_DATA.append(new_pathologist)
```

### 3. Importaci√≥n por Especialidad
```python
# Filtrar por especialidad
oncology_pathologists = [
    p for p in PATHOLOGISTS_DATA 
    if "oncol√≥gica" in p["specialty"].lower()
]
```

## Tipos de Pat√≥logos

### Pat√≥logos Especialistas (PAT)
- **C√≥digo**: PAT001, PAT002, etc.
- **Especialidad**: Anatom√≠a Patol√≥gica, Patolog√≠a Oncol√≥gica
- **Permisos**: Completos para diagn√≥sticos y supervisi√≥n
- **Responsabilidades**: Diagn√≥sticos finales, supervisi√≥n de residentes

### Residentes de Patolog√≠a (RES)
- **C√≥digo**: RES001, RES002, etc.
- **Especialidad**: Residente Patolog√≠a
- **Permisos**: Limitados, requieren supervisi√≥n
- **Responsabilidades**: Diagn√≥sticos preliminares, aprendizaje

### Pat√≥logos Subespecialistas
- **C√≥digo**: SUB001, SUB002, etc.
- **Especialidad**: Dermatopatolog√≠a, Neuropatolog√≠a, etc.
- **Permisos**: Especializados en su √°rea
- **Responsabilidades**: Casos complejos de su especialidad

## Consideraciones Importantes

### üö® Seguridad en Producci√≥n
- **Cambiar contrase√±as**: Las contrase√±as temporales DEBEN cambiarse
- **Emails institucionales**: Usar dominio de la instituci√≥n
- **C√≥digos reales**: Usar c√≥digos de registro m√©dico v√°lidos
- **Verificaci√≥n de identidad**: Validar identidad de pat√≥logos

### üîß Configuraci√≥n Recomendada
- **Variables de entorno**: Usar para configuraci√≥n de emails
- **Archivo de configuraci√≥n**: Externalizar datos de pat√≥logos
- **Integraci√≥n LDAP**: Conectar con directorio institucional
- **Validaci√≥n m√©dica**: Verificar registro profesional

### üìã Requisitos Previos
- Base de datos MongoDB configurada y accesible
- Servicios de pat√≥logos inicializados
- Dependencias de Python instaladas
- Variables de entorno configuradas

### ‚ö†Ô∏è Limitaciones
- Contrase√±as temporales en texto plano
- Datos hardcodeados (considerar externalizar)
- Sin validaci√≥n de registro m√©dico
- Sin integraci√≥n con sistemas externos de credenciales

## Integraci√≥n con Otros M√≥dulos

### M√≥dulo de Usuarios
- Los pat√≥logos son un tipo especializado de usuario
- Heredan funcionalidades base de autenticaci√≥n
- Tienen permisos espec√≠ficos para diagn√≥sticos

### M√≥dulo de Casos
- Los pat√≥logos pueden ser asignados a casos
- Realizan diagn√≥sticos y reportes
- Supervisan el trabajo de residentes

### M√≥dulo de Reportes
- Generan reportes patol√≥gicos
- Firman digitalmente los diagn√≥sticos
- Mantienen historial de casos atendidos

### M√≥dulo de Auditor√≠a
- Registra la creaci√≥n de pat√≥logos
- Mantiene historial de cambios
- Facilita trazabilidad de diagn√≥sticos

Este script es fundamental para establecer el equipo m√©dico especializado que utilizar√° PathSys para realizar diagn√≥sticos patol√≥gicos y gestionar casos cl√≠nicos.